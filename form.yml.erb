<%-
  accounts = OodAppkit.clusters[:klone].custom_config[:accounts]
  hyakparts = OodAppkit.clusters[:klone].custom_config[:hyakparts]
  ckptgpus = OodAppkit.clusters[:klone].custom_config[:ckptgpus]
  my_accounts = {}
  accounts.each do |a, v|
    my_accounts[a] = v if v["users"].include? User.new.name
  end
-%>
---
cluster: "klone"

attributes:
  haccount:
    label: Account
    help: Please select an account from the drop-down.
    widget: select
    options:
      <%- my_accounts.each do |a, v| -%>
      - [ "<%= a %>", "<%= a %>" ]
     <%- end -%>
  hqueue:
    label: Partition
    help: Please select a partition from the drop-down.
    widget: select
    options:
      - [ 'ckpt', 'ckpt',
          data-set-hgputype: 'none',
          data-set-hgpus: 0,
          data-hide-hgpus: true,
        ]
      - [ 'ckpt-g2', 'ckpt-g2',
          data-set-hgputype: 'l40s',
          data-hide-hgputype: 'true',
          data-set-hgpus: 0,
        ]
      - [ 'ckpt-all', 'ckpt-all',
          data-set-hgputype: 'none',
          data-set-hgpus: 0,
          data-hide-hgpus: true,
        ]
      <%- hyakparts.each do |p| -%>
      - [
        "<%= p %>", "<%= p %>",
        <%- my_accounts.each do |a, v|
        if not v["partitions"].include? p -%>
        data-option-for-haccount-<%= a %>: "false",
        <%- end
        end -%>
        data-set-hgputype: "<%= p["gpu"] ? p.sub('gpu-', '') : 'none' %>",
        data-hide-hgputype: true,
        <%- if not p["gpu"] -%>
        data-set-hgpus: 0,
        data-hide-hgpus: true
        <%- end -%>
        ]
      <%- end -%>
  htasks:
    label: Tasks
    widget: number_field
    value: 1
  hcpus:
    label: CPUs per task
    widget: number_field
    value: 1
  hmem:
    label: Memory (GB)
    value: 1
  hgputype:
    label: GPU Type
    widget: select
    options:
      - [ "None", "none", data-set-hgpus: 0, data-hide-hgpus: true ]
      - [ "Any", "", data-set-hgpus: 0 ]
      <%- ckptgpus.each do |k, v| -%>
      - [ "<%= v %>", "<%= k %>",
        <%- if k == "l40s" -%>
        data-option-for-hqueue-ckpt: "false",
        <%- end -%>
        ]
      <%- end -%>
  hgpus:
    label: GPUs
    widget: number_field
    min: 0
    max: 8
    value: 0

form:
  - haccount
  - hqueue
  - htasks
  - hcpus
  - hmem
  - hgputype
  - hgpus
  - bc_num_hours
